
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Mixed-effects Models in R &#8212; An Introduction to Linear Mixed-effects Models</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/test.css?v=a80109f0" />
    <link rel="stylesheet" type="text/css" href="_static/sphericity_3d_files/rglwidgetClass-1.3.18/rgl.css?v=57907efa" />
    <link rel="stylesheet" type="text/css" href="_static/sphericity_3d_files/htmltools-fill-0.5.8.1/fill.css?v=971cc1da" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '5.mixed-R';</script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/textures.src.js?v=9482728f"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/shadersrc.src.js?v=6ce05c17"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/buffer.src.js?v=1efca185"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/mouse.src.js?v=96f0b970"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/projection.src.js?v=98871b91"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/axes.src.js?v=3250d244"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/rglTimer.src.js?v=ac1c3151"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/pretty.src.js?v=4f2cffba"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/shaders.src.js?v=bbbdf37d"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/animation.src.js?v=74f9b9e8"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/pieces.src.js?v=280fd571"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/selection.src.js?v=5b47ed7d"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/init.src.js?v=f5bdcbbb"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/subscenes.src.js?v=42cb429d"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/controls.src.js?v=4b3dbe6f"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/draw.src.js?v=49d9cbaa"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/utils.src.js?v=56efe719"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/rglClass.src.js?v=9e593197"></script>
    <script src="_static/sphericity_3d_files/rglWebGL-binding-1.3.18/rglWebGL.js?v=8cd6f6d7"></script>
    <script src="_static/sphericity_3d_files/htmlwidgets-1.6.4/htmlwidgets.js?v=175713be"></script>
    <script src="_static/sphericity_3d_files/CanvasMatrix4-1.3.18/CanvasMatrix.src.js?v=5a2d04be"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Summary" href="summary.html" />
    <link rel="prev" title="From Multilevel to Mixed-effects" href="4.multilevel-to-mixed.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="0.intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="An Introduction to Linear Mixed-effects Models - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="An Introduction to Linear Mixed-effects Models - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="0.intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1.intro-mixed.html">Introduction to Mixed-effects Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.multilevel-framework.html">The Multilevel Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.multilevel-simulation.html">Simulating a Multilevel Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.multilevel-to-mixed.html">From Multilevel to Mixed-effects</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Mixed-effects Models in <code class="docutils literal notranslate"><span class="pre">R</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="summary.html">Summary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/PCHN63112-Mixed-Models/mixed-effects-intro" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/PCHN63112-Mixed-Models/mixed-effects-intro/issues/new?title=Issue%20on%20page%20%2F5.mixed-R.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/5.mixed-R.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Mixed-effects Models in R</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-mixed-effects-models-with-nlme">Fitting Mixed-effects Models with <code class="docutils literal notranslate"><span class="pre">nlme</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-mixed-effects-models-with-lme4">Fitting Mixed-effects Models with <code class="docutils literal notranslate"><span class="pre">lme4</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inference-in-mixed-effects-models">Inference in Mixed-effects Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-implied-marginal-model">The Implied Marginal Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kenward-rogers-degrees-of-freedom">Kenward-Rogers Degrees of Freedom</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inference-using-nlme">Inference Using <code class="docutils literal notranslate"><span class="pre">nlme</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inference-using-lme4">Inference Using <code class="docutils literal notranslate"><span class="pre">lme4</span></code></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="mixed-effects-models-in-r">
<h1>Mixed-effects Models in <code class="docutils literal notranslate"><span class="pre">R</span></code><a class="headerlink" href="#mixed-effects-models-in-r" title="Link to this heading">#</a></h1>
<p>As the final part of this lesson, we turn to the process of fitting LME models using <code class="docutils literal notranslate"><span class="pre">R</span></code>, as well as options around inference. These examples will all be fairly basic, but we will see more variety in the workshop this week. In addition, we will see that there are <em>two</em> main options in <code class="docutils literal notranslate"><span class="pre">R</span></code> for fitting LME models. The first is the <code class="docutils literal notranslate"><span class="pre">lme()</span></code> function from the <code class="docutils literal notranslate"><span class="pre">nlme</span></code> package and the second is the <code class="docutils literal notranslate"><span class="pre">lmer()</span></code> function from the <code class="docutils literal notranslate"><span class="pre">lme4</span></code> package. We will discuss both below, as well as their advantages and disadvantages.</p>
<section id="fitting-mixed-effects-models-with-nlme">
<h2>Fitting Mixed-effects Models with <code class="docutils literal notranslate"><span class="pre">nlme</span></code><a class="headerlink" href="#fitting-mixed-effects-models-with-nlme" title="Link to this heading">#</a></h2>
<p>We will start with the <code class="docutils literal notranslate"><span class="pre">nlme</span></code> package, both because it is the <em>older</em> of the two and because it is already familiar from the <code class="docutils literal notranslate"><span class="pre">gls()</span></code> function. To fit a LME model, we use the <code class="docutils literal notranslate"><span class="pre">lme()</span></code> function, which has a syntax very similar to the <code class="docutils literal notranslate"><span class="pre">gls()</span></code> function, but with the addition of a <code class="docutils literal notranslate"><span class="pre">random=</span></code> option for specifying the random effects. To understand how to use this, we will return to the long-formatted <code class="docutils literal notranslate"><span class="pre">selfesteem</span></code> data from <code class="docutils literal notranslate"><span class="pre">datarium</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&#39;datarium&#39;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&#39;reshape2&#39;</span><span class="p">)</span>

<span class="nf">data</span><span class="p">(</span><span class="s">&#39;anxiety&#39;</span><span class="p">)</span>
<span class="n">anxiety.grp3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">anxiety</span><span class="p">[</span><span class="n">anxiety</span><span class="o">$</span><span class="n">group</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#39;grp3&#39;</span><span class="p">,]</span><span class="w">   </span><span class="c1"># high exercise group</span>
<span class="n">anxiety.grp3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="n">anxiety.grp3</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="o">=-</span><span class="n">group</span><span class="p">)</span><span class="w"> </span><span class="c1"># remove group column</span>

<span class="c1"># repeats and number of subjects</span>
<span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">3</span>
<span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">anxiety.grp3</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span>

<span class="c1"># reshape wide -&gt; long</span>
<span class="n">anxiety.long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">melt</span><span class="p">(</span><span class="n">anxiety.grp3</span><span class="p">,</span><span class="w">             </span><span class="c1"># wide data frame</span>
<span class="w">                     </span><span class="n">id.vars</span><span class="o">=</span><span class="s">&#39;id&#39;</span><span class="p">,</span><span class="w">             </span><span class="c1"># what stays fixed?</span>
<span class="w">                     </span><span class="n">variable.name</span><span class="o">=</span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="w">     </span><span class="c1"># name for the new predictor</span>
<span class="w">                     </span><span class="n">value.name</span><span class="o">=</span><span class="s">&quot;score&quot;</span><span class="p">)</span><span class="w">       </span><span class="c1"># name for the new outcome</span>

<span class="n">anxiety.long</span><span class="w">           </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">anxiety.long</span><span class="p">[</span><span class="nf">order</span><span class="p">(</span><span class="n">anxiety.long</span><span class="o">$</span><span class="n">id</span><span class="p">),]</span><span class="w"> </span><span class="c1"># order by ID</span>
<span class="nf">rownames</span><span class="p">(</span><span class="n">anxiety.long</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">n</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="w">                            </span><span class="c1"># fix row names</span>
<span class="n">anxiety.long</span><span class="o">$</span><span class="n">id</span><span class="w">        </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">anxiety.long</span><span class="o">$</span><span class="n">id</span><span class="p">)</span><span class="w">            </span><span class="c1"># convert ID to factor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="n">anxiety.long</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  id time score
1 31   t1  14.6
2 31   t2  13.0
3 31   t3  11.7
4 32   t1  15.0
5 32   t2  13.0
6 32   t3  11.9
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lmer.mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lmer</span><span class="p">(</span><span class="n">score</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">anxiety.long</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">lmer.mod</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Linear mixed model fit by REML [&#39;lmerMod&#39;]
Formula: score ~ time + (1 | id)
   Data: anxiety.long
REML criterion at convergence: 84.4371
Random effects:
 Groups   Name        Std.Dev.
 id       (Intercept) 1.3445  
 Residual             0.3034  
Number of obs: 45, groups:  id, 15
Fixed Effects:
(Intercept)       timet2       timet3  
     17.013       -2.000       -3.453  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="n">selfesteem.long</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  id time    score
1  1   t1 4.005027
2  1   t2 5.182286
3  1   t3 7.107831
4  2   t1 2.558124
5  2   t2 6.912915
6  2   t3 6.308434
</pre></div>
</div>
</div>
</div>
<p>Our multilevel model for these data was specified earlier as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{2}
    y_{ij}    &amp;= \mu_{i} + \alpha_{j} + \eta_{ij} &amp;\quad\text{Level 1} \\
    \mu_{i}   &amp;= \mu + \xi_{i}                    &amp;\quad\text{Level 2} \\
\end{alignat*}
\end{split}\]</div>
<p>which we can collapse to a single level by replacing <span class="math notranslate nohighlight">\(\mu_{i}\)</span> with <span class="math notranslate nohighlight">\(\mu + \xi_{i}\)</span>. This gives the LME model</p>
<div class="math notranslate nohighlight">
\[
y_{ij} = \mu + \alpha_{j} + \xi_{i} + \eta_{ij},
\]</div>
<p>where we have <em>two</em> fixed-effects of <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\alpha_{j}\)</span>, and <em>two</em> random-effects of <span class="math notranslate nohighlight">\(\xi_{i}\)</span> and <span class="math notranslate nohighlight">\(\eta_{ij}\)</span>. The <em>fixed-effects</em> are used to construct the <em>marginal</em> mean structure across all subjects, whereas the <em>random-effects</em> are used to construct the <em>marginal</em> variance-covariance structure across all subjects.</p>
<p>To fit this model using <code class="docutils literal notranslate"><span class="pre">lme()</span></code> we use</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">nlme</span><span class="p">)</span>
<span class="n">lme.mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">score</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="o">|</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">selfesteem.long</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>So, the key here is understanding the <code class="docutils literal notranslate"><span class="pre">random=</span></code> syntax. This has a form very similar to what we have seen before when using <code class="docutils literal notranslate"><span class="pre">correlation=</span></code> and <code class="docutils literal notranslate"><span class="pre">weights=</span></code> in the <code class="docutils literal notranslate"><span class="pre">gls()</span></code> function. However, we need to think about this a little differently because we are not defining how we want a particular covariance structure to apply to the data. Instead, we are giving the <em>structure</em> of the random effects.</p>
<p>We can think of this as simply a direct implementation of the LME equation above. We have</p>
<div class="math notranslate nohighlight">
\[
y_{ij} = \overbrace{\mu + \alpha_{j}}^{\text{fixed}} + \overbrace{\xi_{i} + \eta_{ij}}^{\text{random}},
\]</div>
<p>so the <em>fixed-effects</em> part just appears in the model equation as <code class="docutils literal notranslate"><span class="pre">score</span> <span class="pre">~</span> <span class="pre">time</span></code> or, alternatively, <code class="docutils literal notranslate"><span class="pre">score</span> <span class="pre">~</span> <span class="pre">1</span> <span class="pre">+</span> <span class="pre">time</span></code>. The <em>random-effects</em> part consists of <span class="math notranslate nohighlight">\(\xi_{i} + \eta_{ij}\)</span>. Now, we do not need to specify <span class="math notranslate nohighlight">\(\eta_{ij}\)</span> because that is the residual error term that is <em>always</em> included in a linear model. We know this already from <code class="docutils literal notranslate"><span class="pre">lm()</span></code> as we never have to ask for residuals, they are always there. So, the only thing that differentiates the model above from something we could fit with <code class="docutils literal notranslate"><span class="pre">lm()</span></code> is the term <span class="math notranslate nohighlight">\(\xi_{i}\)</span>. This is <em>precisely</em> what we specify using the <code class="docutils literal notranslate"><span class="pre">random=</span></code> argument.</p>
<p>So what is <span class="math notranslate nohighlight">\(\xi_{i}\)</span>? Well, if we look at its index, it is a value that changes with <em>each subject</em>. It is therefore <em>constant</em> within a subject, but different between subjects. So how do we specify a value that is only constant <em>within</em> each subject? Well, we represent it as a constant using a <code class="docutils literal notranslate"><span class="pre">1</span></code> but make it <em>conditional</em> on the subject by using <code class="docutils literal notranslate"><span class="pre">|id</span></code>. So <code class="docutils literal notranslate"><span class="pre">1|id</span></code> can be read as <em>a constant per-subject</em>. This is why this type of model is also known as a <em>random intercept</em> model.</p>
<p>Alternatively, we can go back to the multilevel conceptualisation and think of this as describing the model that we fit to each individual subject. We will use some pseudo-code below to get the idea across, just be aware that most of this is not valid <code class="docutils literal notranslate"><span class="pre">lme()</span></code> syntax (but the ideas are hopefully clear). As described earlier, when we have <em>no replications</em> within each level of the repeated measures, the best we can do with the data from <em>one</em> subject is fit a constant. So our model for one subject would be something like</p>
<p><code class="docutils literal notranslate"><span class="pre">score[id</span> <span class="pre">==</span> <span class="pre">1]</span> <span class="pre">~</span> <span class="pre">1</span></code></p>
<p>If we wanted this to work for <em>all</em> subjects, we would need to indicate that we want a <em>different</em> constant for each subject, which would give something like</p>
<p><code class="docutils literal notranslate"><span class="pre">score</span> <span class="pre">~</span> <span class="pre">1|id</span></code></p>
<p>which we can read as “fit a constant <em>separately</em> for each level of <code class="docutils literal notranslate"><span class="pre">id</span></code>”.</p>
<p>Once we have multiple subjects, we have the option of estimating values by pooling data <em>across</em> subjects. This only works if we assume we are estimating something that is common across the subjects, so we imagine all subjects are drawn from the same population with the same mean. This is where the <em>fixed-effects</em> come in, as a parameterisation of the population mean. So, with multiple subjects, we can add a fixed-effect of <code class="docutils literal notranslate"><span class="pre">time</span></code> in the form <span class="math notranslate nohighlight">\(\mu + \alpha_{j}\)</span>. Using our current pseudo-code, this would give</p>
<p><code class="docutils literal notranslate"><span class="pre">score</span> <span class="pre">~</span> <span class="pre">1|id</span> <span class="pre">+</span> <span class="pre">1</span> <span class="pre">+</span> <span class="pre">time</span></code>.</p>
<p>However, this is <em>not</em> how <code class="docutils literal notranslate"><span class="pre">lme()</span></code> works. Instead, in order to clearly differentiate the random-effects from the fixed-effects, <code class="docutils literal notranslate"><span class="pre">lme()</span></code> requires that we move anything random out of the model equation and put it in a separate argument. So this gives the final <em>real</em> specification of</p>
<p><code class="docutils literal notranslate"><span class="pre">lme(score</span> <span class="pre">~</span> <span class="pre">1</span> <span class="pre">+</span> <span class="pre">time,</span> <span class="pre">random=</span> <span class="pre">~</span> <span class="pre">1|id)</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">lme.mod</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Linear mixed-effects model fit by REML
  Data: selfesteem.long 
  Log-restricted-likelihood: -38.49673
  Fixed: score ~ time 
(Intercept)      timet2      timet3 
   3.140122    1.793820    4.496220 

Random effects:
 Formula: ~1 | id
         (Intercept)  Residual
StdDev: 2.772358e-05 0.8859851

Number of Observations: 30
Number of Groups: 10 
</pre></div>
</div>
</div>
</div>
</section>
<section id="fitting-mixed-effects-models-with-lme4">
<h2>Fitting Mixed-effects Models with <code class="docutils literal notranslate"><span class="pre">lme4</span></code><a class="headerlink" href="#fitting-mixed-effects-models-with-lme4" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">lme4</span><span class="p">)</span>
<span class="n">lmer.mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lmer</span><span class="p">(</span><span class="n">score</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">selfesteem.long</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">VarCorr</span><span class="p">(</span><span class="n">lmer.mod</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>boundary (singular) fit: see help(&#39;isSingular&#39;)
 Groups   Name        Std.Dev.
 id       (Intercept) 0.00000 
 Residual             0.88599 
</pre></div>
</div>
</div>
</div>
<p>… The nice thing about this is that the random effects <em>do</em> appear in the model equation. They are simply differentiated using round brackets. So we can use</p>
<p><code class="docutils literal notranslate"><span class="pre">score</span> <span class="pre">~</span> <span class="pre">(1|id)</span> <span class="pre">+</span> <span class="pre">1</span> <span class="pre">+</span> <span class="pre">time</span></code></p>
<p>though it is more usual to specify the fixed-effects <em>first</em> and the random-effects <em>second</em>. This also helps will conceptualising the random-effects as <em>addition error terms</em>. This gives the final <em>real</em> specification of</p>
<p><code class="docutils literal notranslate"><span class="pre">lmer(score</span> <span class="pre">~</span> <span class="pre">1</span> <span class="pre">+</span> <span class="pre">time</span> <span class="pre">+</span> <span class="pre">(1|id))</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">gls.mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gls</span><span class="p">(</span><span class="n">score</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">correlation</span><span class="o">=</span><span class="nf">corSymm</span><span class="p">(</span><span class="n">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="m">1</span><span class="o">|</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">selfesteem.long</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">gls.mod</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generalized least squares fit by REML
  Model: score ~ time 
  Data: selfesteem.long 
       AIC      BIC    logLik
  87.34893 96.41979 -36.67447

Correlation Structure: General
 Formula: ~1 | id 
 Parameter estimate(s):
 Correlation: 
  1      2     
2 -0.310       
3  0.279 -0.440

Coefficients:
               Value Std.Error   t-value p-value
(Intercept) 3.140122 0.2773446 11.322095   0e+00
timet2      1.793820 0.4488710  3.996293   4e-04
timet3      4.496220 0.3331042 13.497939   0e+00

 Correlation: 
       (Intr) timet2
timet2 -0.809       
timet3 -0.601  0.304

Standardized residuals:
        Min          Q1         Med          Q3         Max 
-1.51407798 -0.63430904 -0.03250738  0.45770104  2.44238240 

Residual standard error: 0.8770406 
Degrees of freedom: 30 total; 27 residual
</pre></div>
</div>
</div>
</div>
</section>
<section id="inference-in-mixed-effects-models">
<h2>Inference in Mixed-effects Models<a class="headerlink" href="#inference-in-mixed-effects-models" title="Link to this heading">#</a></h2>
<section id="the-implied-marginal-model">
<h3>The Implied Marginal Model<a class="headerlink" href="#the-implied-marginal-model" title="Link to this heading">#</a></h3>
<p>… From this perspective, a mixed-effects model is simply GLS, but with a more sophisticated way of constructing the variance-covariance matrix using the random effects. This leads to some important consequences:</p>
<ol class="arabic simple">
<li><p>The inferential issues around GLS are <em>identical</em> for mixed-effects</p></li>
<li><p>The covariance structure is <em>more restricted</em> under mixed-effects, because it is constrained by the random effects themselves</p></li>
</ol>
<p>… The advantages of GLS are still there. For instance, the correct error term for each test can be automatically generated from the covariance structure. So while the model itself may be no better than the repeated measures ANOVA, it is infinitely <em>more practical</em> because we do not need to mess around manually assigning error terms to different tests (and worrying about getting this wrong).</p>
</section>
<section id="kenward-rogers-degrees-of-freedom">
<h3>Kenward-Rogers Degrees of Freedom<a class="headerlink" href="#kenward-rogers-degrees-of-freedom" title="Link to this heading">#</a></h3>
<p>… The advantage is that mixed-effects models capture more <em>structure</em> than GLS models. This means that mixed-effects models embed <em>where</em> the correlation came from. Having that structure in terms of the random effects allows for slightly more sophisticated approaches to the problem of <em>effective degrees of freedom</em>. Because the covariance structure can be decomposed into the random effects, the data structure itself is part of the model of the covariance matrix. This means there is information available that can be used to construct more sophisticated faux degrees of freedom. This information is not there using GLS, because there is only a single big covariance structure that cannot be decomposed into anything related to the model.</p>
<p>Now, of course, this is only an advantage if you agree with the notion of effective degrees of freedom. If you do not, then this new information is still not useful.</p>
</section>
</section>
<section id="inference-using-nlme">
<h2>Inference Using <code class="docutils literal notranslate"><span class="pre">nlme</span></code><a class="headerlink" href="#inference-using-nlme" title="Link to this heading">#</a></h2>
</section>
<section id="inference-using-lme4">
<h2>Inference Using <code class="docutils literal notranslate"><span class="pre">lme4</span></code><a class="headerlink" href="#inference-using-lme4" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">lmerTest</span></code> package</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="4.multilevel-to-mixed.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">From Multilevel to Mixed-effects</p>
      </div>
    </a>
    <a class="right-next"
       href="summary.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Summary</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-mixed-effects-models-with-nlme">Fitting Mixed-effects Models with <code class="docutils literal notranslate"><span class="pre">nlme</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-mixed-effects-models-with-lme4">Fitting Mixed-effects Models with <code class="docutils literal notranslate"><span class="pre">lme4</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inference-in-mixed-effects-models">Inference in Mixed-effects Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-implied-marginal-model">The Implied Marginal Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kenward-rogers-degrees-of-freedom">Kenward-Rogers Degrees of Freedom</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inference-using-nlme">Inference Using <code class="docutils literal notranslate"><span class="pre">nlme</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inference-using-lme4">Inference Using <code class="docutils literal notranslate"><span class="pre">lme4</span></code></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dr Martyn McFarquhar
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2026.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>