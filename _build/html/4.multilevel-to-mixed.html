
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>From Multilevel to Mixed-effects &#8212; An Introduction to Linear Mixed-effects Models</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/test.css?v=a80109f0" />
    <link rel="stylesheet" type="text/css" href="_static/sphericity_3d_files/rglwidgetClass-1.3.18/rgl.css?v=57907efa" />
    <link rel="stylesheet" type="text/css" href="_static/sphericity_3d_files/htmltools-fill-0.5.8.1/fill.css?v=971cc1da" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '4.multilevel-to-mixed';</script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/textures.src.js?v=9482728f"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/shadersrc.src.js?v=6ce05c17"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/buffer.src.js?v=1efca185"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/mouse.src.js?v=96f0b970"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/projection.src.js?v=98871b91"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/axes.src.js?v=3250d244"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/rglTimer.src.js?v=ac1c3151"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/pretty.src.js?v=4f2cffba"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/shaders.src.js?v=bbbdf37d"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/animation.src.js?v=74f9b9e8"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/pieces.src.js?v=280fd571"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/selection.src.js?v=5b47ed7d"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/init.src.js?v=f5bdcbbb"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/subscenes.src.js?v=42cb429d"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/controls.src.js?v=4b3dbe6f"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/draw.src.js?v=49d9cbaa"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/utils.src.js?v=56efe719"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/rglClass.src.js?v=9e593197"></script>
    <script src="_static/sphericity_3d_files/rglWebGL-binding-1.3.18/rglWebGL.js?v=8cd6f6d7"></script>
    <script src="_static/sphericity_3d_files/htmlwidgets-1.6.4/htmlwidgets.js?v=175713be"></script>
    <script src="_static/sphericity_3d_files/CanvasMatrix4-1.3.18/CanvasMatrix.src.js?v=5a2d04be"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Mixed-effects Models in R" href="5.mixed-R.html" />
    <link rel="prev" title="Simulating a Multilevel Model" href="3.multilevel-simulation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="0.intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="An Introduction to Linear Mixed-effects Models - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="An Introduction to Linear Mixed-effects Models - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="0.intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1.intro-mixed.html">Introduction to Mixed-effects Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.multilevel-framework.html">The Multilevel Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.multilevel-simulation.html">Simulating a Multilevel Model</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">From Multilevel to Mixed-effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.mixed-R.html">Mixed-effects Models in <code class="docutils literal notranslate"><span class="pre">R</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="summary.html">Summary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/PCHN63112-Mixed-Models/mixed-effects-intro" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/PCHN63112-Mixed-Models/mixed-effects-intro/issues/new?title=Issue%20on%20page%20%2F4.multilevel-to-mixed.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/4.multilevel-to-mixed.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>From Multilevel to Mixed-effects</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#turning-a-multilevel-models-into-a-mixed-effects-model">Turning a Multilevel Models into a Mixed-effects Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-existing-multilevel-model">The Existing Multilevel Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-lme-trick">The LME Trick</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-collapse-the-hierarchy">Why Collapse the Hierarchy?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages-of-multilevel-lme-models">Advantages of Multilevel/LME Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelling-data-structure">Modelling Data Structure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pooling-and-shrinkage">Pooling and Shrinkage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-bias-variance-tradeoff">The Bias-Variance Tradeoff</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regularisation">Regularisation</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="from-multilevel-to-mixed-effects">
<h1>From Multilevel to Mixed-effects<a class="headerlink" href="#from-multilevel-to-mixed-effects" title="Link to this heading">#</a></h1>
<p>In the previous parts of this lesson we focussed on the multilevel framework. The argument was that this is more intuitive because we can break complex complex data structures into different levels of variation. This allows us to think hierarchically about where data comes from, building up our complexity layer-by-layer. We saw this when we focussed on modelling just a single subject as our experimental unit of interest. We then built in more subjects and expanded the model logically until we came to the multilevel representation. Importantly, this was all based on capturing the <em>data structure</em>, rather than thinking in terms of the <em>covariance structure</em>. Unlike GLS, where we had to reason about the form of the variance-covariance matrix, the covariance structure in the multilevel model was an emergent property of its structure. In a way, we did not need to worry about correlation, as it was taken into account <em>automatically</em>. All we needed to think about was the data structure and the rest followed.</p>
<p>Although this focus on <em>data structure</em> can be more intuitive, it is not how these types of models are typically fit in practice. Now, this is not so much a <em>technical</em> limitation as it is a decision about <em>perspective</em>. Software for explicitly fitting multilevel models does exist. For instance, <a class="reference external" href="https://www.bristol.ac.uk/cmm/software/mlwin/">MLwin</a> developed by the Centre for Multilevel Modelling at the University of Bristol is designed <em>specifically</em> for fitting models from this perspective. As shown in the screenshot below, models are fit by writing the multilevel equations which are then estimated from the given data. This provides a <em>direct</em> connection between the theory and the application of these models to complex datasets.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/mlwin-screenshot-lge.gif"><img alt="_images/mlwin-screenshot-lge.gif" src="_images/mlwin-screenshot-lge.gif" style="width: 600px;" /></a>
</figure>
<p>Another example of this approach is the <a class="reference external" href="https://ssilive.com/license/hlm">HLM</a> software which, as shown below, also specifies these types of models explicitly in terms of equations for the different levels. This illustrates that it <em>is</em> possible to apply the multilevel perspective in practice. It also illustrates why understanding the theory is so important, especially when faced with software that requires you to write the theoretical model down in order to use it.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/hlm-screenshot.png"><img alt="_images/hlm-screenshot.png" src="_images/hlm-screenshot.png" style="width: 600px;" /></a>
</figure>
<p>However, this multilevel perspective is not the typical method used in <code class="docutils literal notranslate"><span class="pre">R</span></code> (or <code class="docutils literal notranslate"><span class="pre">SPSS</span></code>, <code class="docutils literal notranslate"><span class="pre">STATA</span></code> or <code class="docutils literal notranslate"><span class="pre">SAS</span></code>) for these types of models. Instead, these software packages use an <em>equivalent</em> approach in the form of <em>linear mixed-effects</em> (LME) models. In this part of the lesson, we will connect these two perspectives together and then show how these forms of models can be fit in <code class="docutils literal notranslate"><span class="pre">R</span></code> using both the <code class="docutils literal notranslate"><span class="pre">nlme</span></code> package (familiar from the use of <code class="docutils literal notranslate"><span class="pre">gls()</span></code>) and the more recent <code class="docutils literal notranslate"><span class="pre">lme4</span></code> package.</p>
<section id="turning-a-multilevel-models-into-a-mixed-effects-model">
<h2>Turning a Multilevel Models into a Mixed-effects Model<a class="headerlink" href="#turning-a-multilevel-models-into-a-mixed-effects-model" title="Link to this heading">#</a></h2>
<p>To start understanding the equivalence between <em>multilevel</em> models and LME models, we will start with our multilevel model from the previous part of this lesson. We will then walk through the steps of turning it into an LME model.</p>
<section id="the-existing-multilevel-model">
<h3>The Existing Multilevel Model<a class="headerlink" href="#the-existing-multilevel-model" title="Link to this heading">#</a></h3>
<p>To review, we previously finished modelling our simple repeated measures data using the following multilevel specification</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{2}
    y_{ij}    &amp;= \mu_{i} + \alpha_{j} + \eta_{ij}             &amp;\quad\text{Level 1} \\
    \mu_{i}   &amp;= \mu + \xi_{i}                                &amp;\quad\text{Level 2}
\end{alignat*}
\end{split}\]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{2}
    \eta_{ij} &amp;\sim \mathcal{N}\left(0,\sigma^{2}_{w}\right) \\
    \xi_{i}   &amp;\sim \mathcal{N}\left(0,\sigma^{2}_{b}\right).
\end{alignat*}
\end{split}\]</div>
<p>We conceptualised the <em>Level 1</em> model as capturing variation associated with <em>individual</em> subjects, where the error term <span class="math notranslate nohighlight">\(\eta_{ij}\)</span> can be used to capture the <em>within-subject</em> variance term <span class="math notranslate nohighlight">\(\sigma^{2}_{w}\)</span>. We then conceptualised the <em>Level 2</em> model as capturing variation associated with the <em>group</em> of subjects, where the error term <span class="math notranslate nohighlight">\(\xi_{i}\)</span> can be used to capture the <em>between-subjects</em> variance term <span class="math notranslate nohighlight">\(\sigma^{2}_{b}\)</span>. We also saw, via simulations, that this structure implied a compound symmetric variance-covariance matrix where</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{1}
    \text{Var}(y_{ij})                 &amp;= \sigma^{2}_{b} + \sigma^{2}_{w} \\
    \text{Cov}(y_{ij},y_{ij^{\prime}}) &amp;= \sigma^{2}_{b}.
\end{alignat*}
\end{split}\]</div>
</section>
<section id="the-lme-trick">
<h3>The LME Trick<a class="headerlink" href="#the-lme-trick" title="Link to this heading">#</a></h3>
<p>Turning this model into an LME model only requires a single step. ALl we do is <em>collapse</em> the levels together and then work with a <em>single</em> equation. To see how to do this, notice above that the Level 1 equation is given as</p>
<div class="math notranslate nohighlight">
\[
y_{ij} = \mu_{i} + \alpha_{j} + \eta_{ij},
\]</div>
<p>with a separate Level 2 equation telling us what <span class="math notranslate nohighlight">\(\mu_{i}\)</span> is equal to</p>
<div class="math notranslate nohighlight">
\[
\mu_{i} = \mu + \xi_{i}.
\]</div>
<p>Given that we know that <span class="math notranslate nohighlight">\(\mu_{i}\)</span> has a wider definition than given in the Level 1 equation, we can simply insert the equality from Level 2 into Level 1 to give</p>
<div class="math notranslate nohighlight">
\[
y_{ij} = \overbrace{\mu + \xi_{i}}^{\mu_{i}} + \alpha_{j} + \eta_{ij}.
\]</div>
<p>Now, we have a single equation that contains two constants <span class="math notranslate nohighlight">\((\mu,\alpha_{j})\)</span> and two random error-terms <span class="math notranslate nohighlight">\((\xi_{i},\eta_{ij})\)</span>. The constants are termed the <em>fixed-effects</em> and the errors are termed the <em>random-effects</em>. We would usually arrange like-terms together, so the more typical way of writing this would be</p>
<div class="math notranslate nohighlight">
\[
y_{ij} = \overbrace{\mu + \alpha_{j}}^{\text{fixed}} + \overbrace{\xi_{i} + \eta_{ij}}^{\text{random}}
\]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{2}
    \xi_{i}   &amp;\sim \mathcal{N}\left(0,\sigma^{2}_{b}\right) \\
    \eta_{ij} &amp;\sim \mathcal{N}\left(0,\sigma^{2}_{w}\right).
\end{alignat*}
\end{split}\]</div>
<p>So, what we have done here is <em>collapsed</em> our data hierarchy into a <em>single level</em>. This gives us <em>one</em> equation with <em>two</em> error terms.</p>
<div class="tip admonition">
<p class="admonition-title">Partitioned Errors Perspective</p>
<p>All of the above may be starting to sound very familiar from our discussion of the <em>repeated measures ANOVA</em> a couple of weeks ago. In fact, the repeated measures ANOVA <em>is a simple LME model</em>. This is perhaps one of the most important facts of this lesson to understand. It is not uncommon to hear people recommend a mixed-effects model over the repeated measures ANOVA, but this is something of a confusion because a repeated measures ANOVA <em>is already</em> a mixed-effects model. The differences are largely in terms of the mechanics of how this model is estimated and used. Because the repeated measures ANOVA is an <em>older</em> approach, it is not part of a larger or more-general framework for mixed-effects. Instead, it is an application of mixed-effects, within a more restrictive traditional framework.</p>
<p>This fits with everything we know already. We saw how we could make the repeated measures ANOVA work using <code class="docutils literal notranslate"><span class="pre">lm()</span></code>, but only by including the random effects in the model equation as a way of <em>forcing</em> the error to be split. We then had to ignore the tests on the individual coefficients and construct the ANOVA table manually so that the correct terms were treated as error (i.e. the random effects) and the other terms were treated as effects (i.e. the fixed effects). This all aligns with trying to fit the model given above, but within a framework that only has a single error term.</p>
<p>Aligning the multilevel/LME models with the repeated measures ANOVA also gives another useful perspective in terms of <em>partitioned errors</em>. We could rewrite the model above as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{1}
    y_{ij}        &amp;= \mu + \alpha_{j} + \epsilon_{ij} \\
    \epsilon_{ij} &amp;= \xi_{i} + \eta_{ij}
\end{alignat*}
\end{split}\]</div>
<p>where we think just in terms of a normal linear model, but with a more structured error term that can be split into multiple sources<a class="footnote-reference brackets" href="#error-foot" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. The split is exactly what the repeated measures ANOVA is trying to do. This can be helpful because it highlights that the <em>mean function</em> is no different to a normal linear model and the element that changes in a mixed-effects model is the <em>variance function</em>. We saw this previously when discussing the repeated measures ANOVA and now we see it crop-up again because the repeated measures ANOVA <em>is</em> a partitioned error model and thus <em>is</em> a mixed-effects models.</p>
<p>Perhaps the key thing to recognise from all of this is that, because of this equivalence, modelling the <em>same</em> data in the <em>same</em> way using a mixed-effects approach can be <em>no better than the repeated measures ANOVA</em>. In fact, in some ways, it can be <em>worse</em>. We have already seen that the most basic mixed-effects model implies a compound symmetric covariance structure, so this does not fix this issue with the repeated measures ANOVA. So, moving to mixed-effects is not a guarantee of a better model. The framework is more flexible, yes. The estimation method is more flexible, yes. However, the results can be <em>no better</em>. In practice, this is not always well understood by applied researchers.</p>
</div>
</section>
</section>
<section id="why-collapse-the-hierarchy">
<h2>Why Collapse the Hierarchy?<a class="headerlink" href="#why-collapse-the-hierarchy" title="Link to this heading">#</a></h2>
<p>As demonstrated above, the LME model comes from collapsing the different levels of our hierarchy into a single model equation. So, why would we want to do this? Beyond the practical reasons around software implementations, are there are any other advantages to thinking in terms of mixed-effects, rather than multiple levels?</p>
<p>There are some arguments in favour of this, not least that you may actually find the LME perspective more intuitive than thinking in levels of variation. This is something of a personal preference and you will need to decide for yourself how you want to think about all this. The preference in this lesson is for <em>thinking</em> in a hierarchical fashion and then <em>translating</em> that into mixed-effects. However, you may find it more appealing to just jump into mixed-effects and think about linear models with multiple error terms. The choice is yours.</p>
<p>Conceptually, the LME perspective is useful because it makes it clear that these models are always estimated as a <em>single unit</em>, with all the levels informing each other. The multilevel perspective can give the impression that the levels are <em>separate entities</em>, rather than a part of the same whole. When it comes to estimating these models using ML/REML, they will always be expressed in a collapsed fashion. This also prevents the confusion that the levels could be estimated <em>separately</em>. This is possible, and is known more generally as a <em>summary statistics</em> approach<a class="footnote-reference brackets" href="#summarystat-foot" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>, but is not a <em>true</em> multilevel model because it prevents the levels from informing each other. This simplifies the process down to a selection of separate regression models, which is <em>not</em> how these methods typically work.</p>
<p>The argument in this lesson is that collapsing the hierarchy has a distinct <em>disadvantage</em> in terms of intuition. Although both perspectives are <em>mathematically equivalent</em>, the model</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{1}
    y_{ij}    &amp;=    \mu + \alpha_{j} + \xi_{i} + \eta_{ij}   \\
    \xi_{i}   &amp;\sim \mathcal{N}\left(0,\sigma^{2}_{b}\right) \\
    \eta_{ij} &amp;\sim \mathcal{N}\left(0,\sigma^{2}_{w}\right)
\end{alignat*}
\end{split}\]</div>
<p>tells us <em>very little</em> about the data structure. We do not get the same intuition about the data-generating process when written this way. Indeed, it just looks like we have stuck an additional error term into the normal linear model. Although mathematically that <em>is</em> all that has happened, intuitively there is less of a clear sense of <em>why</em> this happened and what it implies. This is why we spent so long with the multilevel model, because jumping over the multilevel perspective straight into mixed-effects is a recipe for confusion. Indeed, this is exactly what many applied researchers do when told to use mixed-effects models. However, this can lead to a conceptual gap where mixed-effects models are just not understood as well as they could be, if the route through multilevel level models was taken instead. So we can think, very broadly, that the hierarchical perspective is the most useful <em>intuitively</em>, but the mixed-effects perspective is the most useful <em>practically</em>.</p>
</section>
<section id="advantages-of-multilevel-lme-models">
<h2>Advantages of Multilevel/LME Models<a class="headerlink" href="#advantages-of-multilevel-lme-models" title="Link to this heading">#</a></h2>
<p>Before we move on to the <em>practical</em> topic of actually fitting these models in <code class="docutils literal notranslate"><span class="pre">R</span></code>, we turn to a brief discussion of the advantages of LME models. Although we have spent a good deal of time discussing the multilevel/LME framework, you may still be wondering <em>why</em> we are going to all this effort, especially when GLS appears to solve our problems more readily than anything we have discussed in this lesson. Below, we will outline the main reasons to push forward with this approach. We will only summaries these at this stage, but will provide clearer demonstrations of some of these ideas a little later.</p>
<section id="modelling-data-structure">
<h3>Modelling Data Structure<a class="headerlink" href="#modelling-data-structure" title="Link to this heading">#</a></h3>
<p>In our previous discussion, GLS was used as a method to get around the presence of correlation within repeated measurement data. We did this by imposing a structure for GLS to remove. This has the distinct disadvantage of requiring us to <em>know</em> what that structure is in order for this to work. If we do not know this, we simply have to guess. However, if we get this <em>wrong</em> then the removal we impose will be <em>imperfect</em>. We saw this already in terms of small samples, but think more carefully about the asymptotic assumptions. We said previously that we can take <span class="math notranslate nohighlight">\(\hat{\boldsymbol{\Sigma}} = \boldsymbol{\Sigma}\)</span> as the sample size gets larger. However, this is only true if we assume that the structure is correct. If we have assumed compound symmetry then the asymptotic tests (indeed, any tests in GLS) are predicated on assuming that the <em>form</em> of the covariance matrix is correct. The uncertainty lies in the values within that structure, not around its general form. So if we are <em>wrong</em> everything falls apart.</p>
<p>Furthermore, for repeated measurements, the correlation is a product of the <em>structure</em> of the data, yet GLS has no knowledge of this structure. It simply removes what we tell it to because GLS is entirely covariance-focussed. It does not care <em>where</em> the correlation comes from, it just treats it as a nuisance to be removed. While this may not be an issue for some types of data, for others using LME models to embedding the structure of the data buys us many advantages. One such advantage is that we do not need to reason about what covariance structure is appropriate when we have complex data with multiple sources of dependency. As we will see next week, LME models can be applied to situations with many levels to the hierarchy. Because the covariance structure is an emergent property of the structure, so long as the structure is captured correctly the most appropriate covariance structure will always just fall out of the model. This changes our focus from <em>capturing covariance</em> to <em>capturing structure</em>. Once we get our head around doing this we are at an advantage because <em>structure</em> is more readily defensible. There is no argument against repeated measurements being collected <em>within</em> subjects, that is a fact of the data. However, there are plenty of arguments around compound symmetry vs sphericity vs unconstrained covariance matrices.</p>
</section>
<section id="pooling-and-shrinkage">
<h3>Pooling and Shrinkage<a class="headerlink" href="#pooling-and-shrinkage" title="Link to this heading">#</a></h3>
<p>Another advantage of LME models is that, by embedding the structure of the data within the model, they can actually <em>use</em> that structure to their advantage. Two phenomena that emerge from the LME framework that are <em>not</em> seen in GLS are <em>pooling</em> and <em>shrinkage</em>. In an LME model, unit-specific effects (such as subject means) are estimated using <em>both</em> the data from that unit and information about the population as a whole. This is known as <em>partial pooling</em>. Units with little data inherently provide <em>noisy estimates</em> on their own. In an LME model, this is automatically taken into account by pulling their estimates toward the population average. On the other hand, units with lots of data are allowed to differ from the population average more strongly. This pulling toward the population mean is called <em>shrinkage</em>. So, subjects with missing data or fewer observations are less likely to bias the estimates because their lack of information is automatically accommodated. Extreme values are only allowed if there is <em>a lot</em> of data supporting them. Importantly, this is an inherent property of estimation within the LME framework. It is not specified by the analyst <em>a priori</em>, it is just something that happens. This is why LME models can be so useful in the real-world because missing data is not problematic, it is something the model will automatically accommodate. This is <em>not</em> true of GLS, where <em>no pooling</em> takes place. GLS makes no adjustments for noisy or uncertain data so estimates are never <em>shrunk</em> towards a population average. Indeed, GLS knows nothing about <em>units</em> or <em>subjects</em> and so this lack of structure means this cannot happen. Subjects with missing data just contribute less to the estimation of the covariance structure, but there is no inherent weighting that uses this lack of information to balance the estimates.</p>
</section>
<section id="the-bias-variance-tradeoff">
<h3>The Bias-Variance Tradeoff<a class="headerlink" href="#the-bias-variance-tradeoff" title="Link to this heading">#</a></h3>
<p>A key concept within statistical modelling is the <em>bias-variance</em> tradeoff. Here, <em>bias</em> refers to a model being <em>systematically wrong</em>. Even with more data, the model predictions are off from the true values by some amount. In other words, the model keeps <em>missing</em> in some consistent way. <em>Variance</em> then refers to <em>instability</em>. With each new sample the model estimates differ <em>wildly</em>, with no consistency from sample to sample. These are two ends of a spectrum. <em>Bias</em> comes from a model that is too <em>rigid</em>, so irrespective of the data it keeps making the same mistakes. <em>Variance</em> comes from a model that is too <em>flexible</em>. It over-reacts to new data, shifting itself around constantly. A model with <em>high bias</em> will give similar answers with new data, so it is <em>consistent</em> and <em>reliable</em>, but <em>inflexible</em> and may not fit the data very well. A model with <em>high variance</em> will keep changing its answers with new data, so it is <em>inconsistent</em> and <em>unreliable</em>, but <em>flexible</em> and may fit the data much better. The <em>trade-off</em> is that we cannot minimise <em>both</em>. We either keep our model <em>simple</em> and <em>rigid</em>, which reduces variance and increases bias, or we make our model <em>complex</em> and <em>flexible</em>, which increases variance but reduces bias. We cannot do <em>both</em>.</p>
<p>Where an LME model is useful is because it provides one particular “solution” to this issue. By applying <em>partial pooling</em> and <em>shrinking</em> values towards the population average the model is able to introduce a small amount of <em>bias</em>. By not allowing the estimates to be solely governed by the noisy data of any particular individual, the model becomes more rigid and less reactive to the data. This is a principled way of introducing a little bit of sensible bias, which then allows for a substantial reduction in variance. By applying partial pooling, new data from the same population will not dramatically shift the model estimates. The model is not so rigid that it will not change for new data, but that change has been regulated by balancing the information provided by noisy subjects and using the population <em>as a whole</em> to determine sensible estimates. This is a balancing of information that provides a sensible compromise, yet the analyst does not need to do anything. This is all automatic and built-in to the framework. A GLS model does not, indeed <em>cannot</em>, do this.</p>
</section>
<section id="regularisation">
<h3>Regularisation<a class="headerlink" href="#regularisation" title="Link to this heading">#</a></h3>
<p>Another perspective on <em>partial pooling</em> is as a form of <em>regularisation</em>. Regularisation is a broader concept in mathematics, but we can think of it as the use of some sort of <em>penalty</em> or <em>restriction</em> that forces our model to give us <em>sensible answers</em>. This is key because ultimately any mathematical model simply produces numbers based on some other numbers. In order for this to be useful, we need to introduce constraints in terms of what numbers the model can spit out. If it gives us values that are way off the scale of what we are measuring, or is predicting responses that are implausible, then it is not a very good model. The introduction of <em>penalties</em> or <em>restrictions</em> is known as <em>regularising the solution</em>. These penalties are not usually all-or-nothing. We do not make certain values <em>impossible</em>, rather the penalty scales with plausibility <em>and</em> the amount of data. The model is therefore allowed to consider extreme values, but <em>only</em> when these are overwhelmingly supported by the data. Bayesian methods embed this in their overarching framework. Frequentist methods do not always do this, but the behaviour of an LME model does allow this to a degree. Pooling and shrinkage are a <em>form</em> of regularisation. A subject is only allowed to have a mean that is <em>extreme</em>, in terms of its distance from the population average, if they also have <em>a lot</em> of data supporting this value. If they do not, their mean will be <em>shrunk</em> towards the population average in order to <em>regularise</em> the solution. This keeps the model <em>sensible</em> and balances the structure we have imposed with what the data is telling us.</p>
<aside class="topic">
<p class="topic-title">What do you now know?</p>
<p>In this section, we have explored … . After reading this section, you should have a good sense of :</p>
<ul class="simple">
<li><p>…</p></li>
<li><p>…</p></li>
<li><p>…</p></li>
</ul>
</aside>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="error-foot" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>This also explains why we did not use the usual symbol of <span class="math notranslate nohighlight">\(\epsilon_{ij}\)</span> for the errors until now.</p>
</aside>
<aside class="footnote brackets" id="summarystat-foot" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>In the wild, you find summary statistic approaches applied to problems such as <em>meta-analyses</em>, where the effect sizes from each study are taken as the summaries, or in <em>fMRI</em>, where estimates of signal change from each subject are taken as the summaries.</p>
</aside>
</aside>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="3.multilevel-simulation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Simulating a Multilevel Model</p>
      </div>
    </a>
    <a class="right-next"
       href="5.mixed-R.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Mixed-effects Models in <code class="docutils literal notranslate"><span class="pre">R</span></code></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#turning-a-multilevel-models-into-a-mixed-effects-model">Turning a Multilevel Models into a Mixed-effects Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-existing-multilevel-model">The Existing Multilevel Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-lme-trick">The LME Trick</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-collapse-the-hierarchy">Why Collapse the Hierarchy?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages-of-multilevel-lme-models">Advantages of Multilevel/LME Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelling-data-structure">Modelling Data Structure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pooling-and-shrinkage">Pooling and Shrinkage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-bias-variance-tradeoff">The Bias-Variance Tradeoff</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regularisation">Regularisation</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dr Martyn McFarquhar
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2026.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>